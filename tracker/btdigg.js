var tmp_num = tracker.length;
tracker[tmp_num] = function () {
    var name = 'BTDigg';
    var filename = 'btdigg';
    var id = null;
    var icon = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEKGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS4xLjIiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iPgogICAgICAgICA8eG1wOk1vZGlmeURhdGU+MjAxMi0xMS0yOFQxMDoxMTowMDwveG1wOk1vZGlmeURhdGU+CiAgICAgICAgIDx4bXA6Q3JlYXRvclRvb2w+UGl4ZWxtYXRvciAyLjEuMTwveG1wOkNyZWF0b3JUb29sPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICAgICA8dGlmZjpZUmVzb2x1dGlvbj43MjwvdGlmZjpZUmVzb2x1dGlvbj4KICAgICAgICAgPHRpZmY6Q29tcHJlc3Npb24+NTwvdGlmZjpDb21wcmVzc2lvbj4KICAgICAgICAgPHRpZmY6UmVzb2x1dGlvblVuaXQ+MTwvdGlmZjpSZXNvbHV0aW9uVW5pdD4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzI8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDxleGlmOlBpeGVsWERpbWVuc2lvbj4xNjwvZXhpZjpQaXhlbFhEaW1lbnNpb24+CiAgICAgICAgIDxleGlmOkNvbG9yU3BhY2U+NjU1MzU8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjE2PC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Clkt1JIAAAI8SURBVDgRjVO/a1NRGD3ffS+/OiVItZpNhKKkIo4WpSLipIIdxC4OOokuRWxThZKiJIUMXZx0cTLQwR8I0r+gOIilqYuTTqURi6Fom/fue5/n5tESQWw+eD/vd849595zRVXRW7WmFDoewkyEYQjGyyU8qjXxYOcH6rNjant73bvZ/bEI8dy7AOeyFs+MwVl+ThBc5/N2Ko/S/KosPPkiRde3W7KroLoiowTdVIOWgTykMCsGvpcCog6U9JuR1XbH4lLa4FBwCsuz0LhLUP0kgzEw4PtY9jNyOAoS/l53hvpii23j62YUYWl6RG+5Lt/dOPOk8XENkeQduBfoxl3FEe0Z5IwnxTjSVm1NrtPqkql8lSxiNCjygEkh9y9wQpEQ25ATejJNzFXbQmiyW7hPHW9FkafEfYuL7NRYKD6GQyh5VybxIQhwxM/KGSezn6Jlo4JhwwSYX9uocIXHI0rrt2iVMvCmEGLGO38HP8XiO4xcYAicwn0rjgkHijse1Axs4TPjNEJZfYHddrLanPTyQA5PTZBGmgvyKop1LkVp8h8abiOYgd9GdIOBu3HvmHb2kji/Js/ZcFGtDLrt7N0RR+pOjM8JwkDXrWKUPTszx3W9exYqjEgc4EVgMabQdXZv0FDsZ7rhccGyTlgQ6Byf7zzBkAM7L3sK3Ed9VQ6y8y7PXINeX3NtFkk2wWuBw6eZl8bUCX2fGE0i9xeBI3FFRX6miXL5JB5XV1Ah2cvtDr5lC0hNHdV20pXc/wBs5uU1+j7hpAAAAABJRU5ErkJggg%3D%3D';
    var url = 'http://btdigg.org/search';
    var root_url = 'http://btdigg.org';
    var about = 'Это поисковая система по сети BitTorrent DHT, которая анализирует сеть и предоставляет полнотекстовый поиск по активным торрентам';
    /*
     * a = требует авторизации
     * l = русскоязычный или нет
     * rs= поддержка русского языка
    */
    var flags = {
        a : 0,
        l : 1,
        rs: 1
    }
    var xhr = null;
    var web = function () {
        var calculateTime = function (t) {
            var old = parseFloat(t.replace(/\s/,' ').split(' ')[0])*24*60*60;
            return Math.round((new Date()).getTime() / 1000) - old;
        }
        var calculateSize = function (s) {
            var type = '';
            var size = s.replace(' ','');
            var t = size.replace('КБ','');
            if (t.length!= size.length) {
                t = parseFloat(t);
                return Math.round(t*1024);
            }
            var t = size.replace('МБ','');
            if (t.length!= size.length) {
                t = parseFloat(t);
                return Math.round(t*1024*1024);
            }
            var t = size.replace('ГБ','');
            if (t.length!= size.length) {
                t = parseFloat(t);
                return Math.round(t*1024*1024*1024);
            }
            var t = size.replace('ТБ','');
            if (t.length!= size.length) {
                t = parseFloat(t);
                return Math.round(t*1024*1024*1024*1024);
            }
            return 0;
        }
        var readCode = function (c) {
            c = view.contentFilter(c);
            var t = $(c).find('#search_res').children('table').children('tbody').children('tr');
            var hash = 0;
            if (t.length == 0) {
                t = $(c).find('#torrent_info').find('table.torrent_info_tbl').children('tbody').children('tr');
                hash = 1;
            }
            if (hash) {
                var url = t.eq(2).children('td').eq(1).children('a').attr('href');
                var arr = [];
                if (url == null)
                    return arr;
                arr[arr.length] = {
                    'category' : {
                        'id': -1
                    },
                    'title' : t.eq(3).children('td').eq(1).text(),
                    'url' : root_url+'/search?info_hash='+url.split('btih:')[1].replace('&dn=','&q='),
                    'size' : calculateSize(t.eq(5).children('td').eq(1).text()),
                    'dl' : url,
                    'seeds' : 1,
                    'leechs' : t.eq(4).children('td').eq(1).text(),
                    'time' : calculateTime(t.eq(6).children('td').eq(1).text())
                }
            } else {
                var l = t.length;
                var arr = [];
                var i = 0;
                for (i = 0;i<l;i++) {
                    var td = t.eq(i).children('td').eq(1).children('table');
                    var name_link = td.eq(0).find('td.torrent_name').children('a');
                    var params = td.eq(1).children('tbody').children('tr').children('td');
                    arr[arr.length] = {
                        'category' : {
                            'id': -1
                        },
                        'title' : name_link.text(),
                        'url' : root_url+name_link.attr('href'),
                        'size' : calculateSize(params.eq(2).children('span.attr_val').text()),
                        'dl' : params.eq(0).children('a').attr('href'),
                        'seeds' : 1,
                        'leechs' : params.eq(4).children('span.attr_val').text(),
                        'time' : calculateTime(params.eq(5).children('span.attr_val').text())
                    }
                }
            }
            return arr;
        }
        var loadPage = function (text) {
            var t = text;
            var hash = '';
            if (text.length == 40 && text.replace(/[a-zA-Z0-9]/g,'') == '')
                hash = text;
            if (xhr != null)
                xhr.abort();
            xhr = $.ajax({
                type: 'GET',
                url: url,
                cache : false,
                data: {
                    'info_hash' : hash,
                    'q' : text,
                    'order' : 0
                },
                success: function(data) {
                    view.result(id,readCode(data),t);
                },
                error:function (){
                    view.loadingStatus(2,id);
                }
            });
        }
        return {
            getPage : function (a) {
                return loadPage(a);
            }
        }
    }();
    var find = function (text) {
        return web.getPage(text);
    }
    return {
        find : function (a) {
            return find(a);
        },
        setId : function (a) {
            id = a;
        },
        id : id,
        name : name,
        icon : icon,
        about : about,
        url : root_url,
        filename : filename,
        flags : flags
    }
}();
engine.ModuleLoaded(tmp_num);